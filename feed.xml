<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.0.0">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2022-02-11T13:29:12+02:00</updated><id>/feed.xml</id><title type="html">Orestis Papadopoulos</title><subtitle>I'm Orestis Papadopoulos. I work as a software developer. This is my blog, I write about software, sounds and Swift.
</subtitle><author><name>Orestis Papadopoulos</name></author><entry><title type="html">UserDefaultsPeristable: Save and Load a struct in UserDefaults</title><link href="/swift/userdefaults/ios/protocols/2021/10/10/Load-and-save-a-struct.html" rel="alternate" type="text/html" title="UserDefaultsPeristable: Save and Load a struct in UserDefaults" /><published>2021-10-10T18:33:36+03:00</published><updated>2021-10-10T18:33:36+03:00</updated><id>/swift/userdefaults/ios/protocols/2021/10/10/Load-and-save-a-struct</id><content type="html" xml:base="/swift/userdefaults/ios/protocols/2021/10/10/Load-and-save-a-struct.html">&lt;p&gt;The user’s defaults database is a key-value store that let’s you persist data across app launches. It is meant to be used to store user preferences. Using the &lt;code class=&quot;highlighter-rouge&quot;&gt;Codeable&lt;/code&gt; protocol and a &lt;code class=&quot;highlighter-rouge&quot;&gt;JSONEncoder&lt;/code&gt; you can very easily convert Swift types to JSON data in order to store them.&lt;/p&gt;

&lt;h2 id=&quot;saveload-codeable-structs&quot;&gt;Save/Load Codeable structs&lt;/h2&gt;

&lt;p&gt;To save data into &lt;code class=&quot;highlighter-rouge&quot;&gt;UserDefaults&lt;/code&gt; you must first encode it as JSON, and then save it using a specified key like this:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Codeable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;userSettings&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;JSONEncoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;UserDefaults&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;standard&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;archiveKey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then you can load it like this:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;savedSettingsData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UserDefaults&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;standard&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;archiveKey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as?&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;decoder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;JSONDecoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;loadedSettings&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedSettingsData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Settings?&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;reusability&quot;&gt;Reusability&lt;/h2&gt;

&lt;p&gt;Using Swift protocols and &lt;a href=&quot;https://docs.swift.org/swift-book/LanguageGuide/Protocols.html#ID280&quot;&gt;protocol inheritance&lt;/a&gt;, we can define a&lt;code class=&quot;highlighter-rouge&quot;&gt;UserDefaultsPeristable&lt;/code&gt; protocol:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;protocol&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;DefaultInitializable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;protocol&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UserDefaultsPeristable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Codable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;DefaultInitializable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We also defined another protocol called &lt;code class=&quot;highlighter-rouge&quot;&gt;DefaultInitializable&lt;/code&gt; for types than can be initialized with a default value using a default initializer. The default value will be used in cases where we’re looking for the specific type in &lt;code class=&quot;highlighter-rouge&quot;&gt;UserDefaults&lt;/code&gt; and it does not exist.&lt;/p&gt;

&lt;p&gt;In order to provide a default implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;save&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;load&lt;/code&gt; functions we will also create a &lt;code class=&quot;highlighter-rouge&quot;&gt;UserDefaultsPersister&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UserDefaultsPersister&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UserDefaultsPeristable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;JSONEncoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;UserDefaults&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;standard&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;savedSettingsData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UserDefaults&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;standard&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as?&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;decoder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;JSONDecoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;loadedSettings&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedSettingsData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loadedSettings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;??&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And provide the default implementations for &lt;code class=&quot;highlighter-rouge&quot;&gt;UserDefaultsPersistable&lt;/code&gt; protocol:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UserDefaultsPeristable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;UserDefaultsPersister&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Self&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UserDefaultsPersister&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;usage&quot;&gt;Usage&lt;/h2&gt;

&lt;p&gt;For example, if you want to persist your app’s Audio settings:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AudioPreferences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UserDefaultsPeristable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;userAudioPreferences&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;volume&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// default value&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;treble&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;quality&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;audioPreferences&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AudioPreferences&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// user modifies volume&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;audioPreferences&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;volume&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;audioPreferences&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Audio preferences are saved in user defaults&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Declaring a type to be &lt;code class=&quot;highlighter-rouge&quot;&gt;UserDefaultsPersistable&lt;/code&gt; allows you to easily store it in &lt;code class=&quot;highlighter-rouge&quot;&gt;UserDefaults&lt;/code&gt; by only specifying a key. Obviously with this approach you can’t store more than one instance of the same type but when it comes to storing user preferences this is a safety mechanism rather than a limitation.&lt;/p&gt;

&lt;p&gt;Feel free to &lt;a href=&quot;mailto:orjpap@gmail.com&quot;&gt;contact me&lt;/a&gt; or tweet to me on &lt;a href=&quot;https://twitter.com/orjpap&quot;&gt;Twitter&lt;/a&gt; for tips, feedback, opinions.&lt;/p&gt;

&lt;p&gt;Thank you for reading!&lt;/p&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">The user’s defaults database is a key-value store that let’s you persist data across app launches. It is meant to be used to store user preferences. Using the Codeable protocol and a JSONEncoder you can very easily convert Swift types to JSON data in order to store them.</summary></entry><entry><title type="html">How To Upload Data To A Server: Multipart/Form-Data HTTP Requests in Swift</title><link href="/swift/http/ios/urlsession/2021/04/26/Multipart-Form-Requests.html" rel="alternate" type="text/html" title="How To Upload Data To A Server: Multipart/Form-Data HTTP Requests in Swift" /><published>2021-04-26T18:33:36+03:00</published><updated>2021-04-26T18:33:36+03:00</updated><id>/swift/http/ios/urlsession/2021/04/26/Multipart-Form-Requests</id><content type="html" xml:base="/swift/http/ios/urlsession/2021/04/26/Multipart-Form-Requests.html">&lt;p&gt;So you are making your first face beautifier&lt;strong&gt;©&lt;/strong&gt; app and it’s about time to upload some images to a server. The backend person asks you to do it via a type of HTTP POST request known as &lt;code class=&quot;highlighter-rouge&quot;&gt;multipart/form-data&lt;/code&gt;. Soon you come to realise that &lt;code class=&quot;highlighter-rouge&quot;&gt;URLSession&lt;/code&gt; does not provide you with an out of the box &lt;code class=&quot;highlighter-rouge&quot;&gt;URLRequest&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;DataTask&lt;/code&gt; for this specific task, despite the fact that this is a very standard way of uploading data.&lt;/p&gt;

&lt;p&gt;And that’s when you reach for &lt;a href=&quot;https://github.com/Alamofire/Alamofire&quot;&gt;Alamofire&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Or&lt;/strong&gt; you can stick with &lt;code class=&quot;highlighter-rouge&quot;&gt;URLSession&lt;/code&gt; and make your own &lt;code class=&quot;highlighter-rouge&quot;&gt;MultipartFormDataRequest&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;It works like this:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;uploadImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;imageData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MultipartFormDataRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;https://server.com/uploadPicture&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;addDataField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;named&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;profilePicture&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;imageData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mimeType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;img/jpeg&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;URLSession&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shared&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;dataTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;MultipartFormDataRequest&lt;/code&gt; is very similar to a &lt;code class=&quot;highlighter-rouge&quot;&gt;URLRequest&lt;/code&gt; in that it is initialised by a URL. The URL endpoint that you will be sending data to.&lt;/p&gt;

&lt;p&gt;Use &lt;code class=&quot;highlighter-rouge&quot;&gt;addTextField&lt;/code&gt; to send text and &lt;code class=&quot;highlighter-rouge&quot;&gt;addDataField&lt;/code&gt; to send anything that can be converted to &lt;code class=&quot;highlighter-rouge&quot;&gt;Data&lt;/code&gt; (images, audio, Grand Theft Auto 2 savefiles, you name it)&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MultipartFormDataRequest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;boundary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UUID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuidString&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;httpBody&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;NSMutableData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;URL&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addTextField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;named&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;httpBody&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;textFormField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;named&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;textFormField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;named&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fieldString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;--&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boundary&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Content-Disposition: form-data; name=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;\(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)\&quot;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Content-Type: text/plain; charset=ISO-8859-1&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Content-Transfer-Encoding: 8bit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fieldString&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addDataField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;named&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mimeType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;httpBody&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;dataFormField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;named&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mimeType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mimeType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataFormField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;named&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nv&quot;&gt;mimeType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fieldData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;NSMutableData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;fieldData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;--&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boundary&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Content-Disposition: form-data; name=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;\(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)\&quot;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Content-Type: &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mimeType&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fieldData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fieldData&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;NSMutableData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;using&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You also need a function to convert a &lt;code class=&quot;highlighter-rouge&quot;&gt;MultipartFormDataRequest&lt;/code&gt; to a &lt;code class=&quot;highlighter-rouge&quot;&gt;URLRequest&lt;/code&gt; in order to be able to create &lt;code class=&quot;highlighter-rouge&quot;&gt;URLSessionDataTasks&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;asURLRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;URLRequest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;URLRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpMethod&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;POST&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;setValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;multipart/form-data; boundary=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boundary&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forHTTPHeaderField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;httpBody&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;appendString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;--&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boundary&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;--&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpBody&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpBody&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Bonus round:&lt;/p&gt;

&lt;p&gt;A handy &lt;code class=&quot;highlighter-rouge&quot;&gt;URLSession&lt;/code&gt; extension. You can also make this an upload task, or use background sessions etc.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;URLSession&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;MultipartFormDataRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                  &lt;span class=&quot;nv&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;@escaping&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;URLResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;URLSessionDataTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;asURLRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this is it. You can now upload your image to the server. A very good example of how simple (or scary) HTTP can be.&lt;/p&gt;

&lt;p&gt;I didn’t go into much detail about the HTTP specifics because:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;This is a sort of tl;dr blog post where I’m sharing some (I hope) useful code with you&lt;/li&gt;
  &lt;li&gt;Donny Wals has done an excellent job at explaining this in &lt;a href=&quot;https://www.donnywals.com/uploading-images-and-forms-to-a-server-using-urlsession/&quot;&gt;his blog post&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;You can read about it &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Feel free to &lt;a href=&quot;mailto:orjpap@gmail.com&quot;&gt;contact me&lt;/a&gt; or tweet to me on &lt;a href=&quot;https://twitter.com/orjpap&quot;&gt;Twitter&lt;/a&gt; for tips, feedback, opinions.&lt;/p&gt;

&lt;p&gt;Thank you for reading!&lt;/p&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">So you are making your first face beautifier© app and it’s about time to upload some images to a server. The backend person asks you to do it via a type of HTTP POST request known as multipart/form-data. Soon you come to realise that URLSession does not provide you with an out of the box URLRequest or DataTask for this specific task, despite the fact that this is a very standard way of uploading data.</summary></entry><entry><title type="html">Pragmatic Playground Driven Development (Part 1)</title><link href="/swift/xcode/playgrounds/frameworks/2020/12/07/Playground-Driven-Development.html" rel="alternate" type="text/html" title="Pragmatic Playground Driven Development (Part 1)" /><published>2020-12-07T06:33:36+02:00</published><updated>2020-12-07T06:33:36+02:00</updated><id>/swift/xcode/playgrounds/frameworks/2020/12/07/Playground-Driven-Development</id><content type="html" xml:base="/swift/xcode/playgrounds/frameworks/2020/12/07/Playground-Driven-Development.html">&lt;p&gt;Using Xcode Playgrounds speeds up your development cycle by reducing compile times. You can make changes to a view, hit compile and view the change in seconds. However, adding Playgrounds that instantiate controllers from your application can be frustrating.&lt;/p&gt;

&lt;p&gt;Anything in an App Target is not visible to the playground because App Targets do not define a module. A module is defined bla bla.&lt;/p&gt;

&lt;p&gt;That’s where frameworks come to play&lt;/p&gt;

&lt;p&gt;What you gain from modularising your application using frameworks:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Dependencies become immediately apparent, pushing your to think about designing dependencies. It’s important to &lt;u&gt;care&lt;/u&gt; about dependencies. The better you separate your code from its dependencies the more testable, readable, maintainable it becomes.&lt;/li&gt;
  &lt;li&gt;Shorter build times when you make changes to a module. Xcode needs to compile only that module.&lt;/li&gt;
  &lt;li&gt;Code reuse in different projects and easier integration.&lt;/li&gt;
  &lt;li&gt;Provide clearer interfaces and better encapsulation. The framework only exposes what’s needed&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;All of this with minimum overhead.&lt;/p&gt;

&lt;p&gt;What you gain from using Playgrounds:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Your View Controllers will need to have managed dependencies for Playgrounds to make sense. To be able to load a View Controller in isolation means that it’s well set up for &lt;u&gt;tests&lt;/u&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;from the fine gents over at &lt;a href=&quot;https://www.pointfree.co/episodes/ep21-playground-driven-development&quot;&gt;Point Free&lt;/a&gt;. Their video introduces their way of using Playgrounds in their everyday development. This blog series provides some extra tips learnt the hard way in development&lt;/p&gt;

&lt;p&gt;And even when it becomes clear, Playgrounds crash and will crash and unfortunately most of the times without any useful debugging information since Playgrounds run using the &lt;a href=&quot;https://developer.apple.com/swift/blog/?id=18&quot;&gt;Swift REPL&lt;/a&gt; (more on this on part 2).&lt;/p&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">Using Xcode Playgrounds speeds up your development cycle by reducing compile times. You can make changes to a view, hit compile and view the change in seconds. However, adding Playgrounds that instantiate controllers from your application can be frustrating.</summary></entry><entry><title type="html">AVAudioSourceNode, AVAudioSinkNode: Low-Level Audio In Swift</title><link href="/swift/real-time/audio/avfoundation/2020/06/19/avAudioSourceNode.html" rel="alternate" type="text/html" title="AVAudioSourceNode, AVAudioSinkNode: Low-Level Audio In Swift" /><published>2020-06-19T07:33:36+03:00</published><updated>2020-06-19T07:33:36+03:00</updated><id>/swift/real-time/audio/avfoundation/2020/06/19/avAudioSourceNode</id><content type="html" xml:base="/swift/real-time/audio/avfoundation/2020/06/19/avAudioSourceNode.html">&lt;p&gt;Apple &lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2019/510&quot;&gt;introduced&lt;/a&gt; &lt;strong&gt;AVAudioSourceNode&lt;/strong&gt; and &lt;strong&gt;AVAudioSinkNode&lt;/strong&gt; in WWDC2019. These two new AVAudio nodes are part of the &lt;a href=&quot;https://developer.apple.com/documentation/avfoundation&quot;&gt;AVFoundation&lt;/a&gt; framework and can be used in macOS 10.15 and iOS 13 onwards.&lt;/p&gt;

&lt;p&gt;They provide a way to &lt;strong&gt;process input&lt;/strong&gt; from an audio device/file, and &lt;strong&gt;generating output&lt;/strong&gt; to a device/file, &lt;em&gt;sample by sample&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;AVAudioSourceNode &lt;em&gt;sends&lt;/em&gt; audio to an AVAudioEngine node. The audio is computed in a callback and can be rendered in real-time or offline modes.&lt;/p&gt;

&lt;p&gt;AVAudioSinkNode &lt;em&gt;receives&lt;/em&gt; audio from an AVAudioEngine node. The audio is processed in a callback and can be rendered in real-time or offline modes.&lt;/p&gt;

&lt;p&gt;The following code outputs five seconds of white noise using an AVAudioSourceNode:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AVFoundation&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;whiteNoise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Float&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;whiteNoiseGenerator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AVAudioSourceNode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;silence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frameCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;audioBufferList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;OSStatus&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ablPointer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UnsafeMutableAudioBufferListPointer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;audioBufferList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frameCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;whiteNoise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ablPointer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UnsafeMutableBufferPointer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UnsafeMutableBufferPointer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;noErr&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;engine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AVAudioEngine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;whiteNoiseGenerator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;whiteNoiseGenerator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainMixerNode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainMixerNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outputVolume&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;try!&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Two things might baffle Swift programmers in this example:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;UnsafeMutableAudioBufferListPointer&lt;/strong&gt; and &lt;strong&gt;UnsafeMutableBufferPointer&lt;/strong&gt;.&lt;/p&gt;

    &lt;p&gt;By default, Swift is memory safe: It prevents direct access to memory and makes sure you’ve initialized everything before you use it. But you can also use &lt;em&gt;unsafe Swift&lt;/em&gt;, which lets you access memory directly through pointers. In this example we use an UnsafeMutableBufferPointer instance in low level operations to eliminate uniqueness checks and bounds checks. I recommend reading &lt;a href=&quot;https://pfandrade.me/blog/unsafe-swift/&quot;&gt;Unsafe Swift&lt;/a&gt; by Paulo Andrande to get a better understanding of the unsafe side of Swift.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The &lt;strong&gt;OSStatus&lt;/strong&gt; return type.&lt;/p&gt;

    &lt;p&gt;Almost every Apple C API function signals success or failure through their return value, which is of type OSStatus. Any status other than noErr (which is 0) signals an error. You can find more details &lt;a href=&quot;https://www.osstatus.com/search/results?platform=all&amp;amp;framework=all&amp;amp;search=&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;why-unsafe-swift&quot;&gt;Why unsafe Swift?&lt;/h2&gt;

&lt;p&gt;First of all unsafe Swift lets you work with &lt;a href=&quot;https://codeburst.io/pointers-in-5-minutes-b94f9d1dfdb5&quot;&gt;pointers&lt;/a&gt; and interoprate with C libraries.&lt;/p&gt;

&lt;p&gt;In addition, unsafe Swift can help you gain a performance boost by sacrificing memory safety. The code you write in the AVAudioSourceNode’s block &lt;em&gt;must be realtime compliant&lt;/em&gt;. Your callback is called in a real-time thread with a hard deadline. @44,1khz sampling rate with a buffer size of 512 samples gives you ~11ms to complete processing in your callback. If that’s not the case, you get silence. That time limit prohibits:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Memory Allocations&lt;/li&gt;
  &lt;li&gt;Using Locks&lt;/li&gt;
  &lt;li&gt;Network Requests or any kind of I/O&lt;/li&gt;
  &lt;li&gt;Memory boundary checks/uniqueness checks&lt;/li&gt;
  &lt;li&gt;Checking your Twitter&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Check out &lt;a href=&quot;https://github.com/apple/swift/blob/master/docs/OptimizationTips.rst&quot;&gt;this guide&lt;/a&gt; on writing high-performance Swift code.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;AVFoundation really suprised me. It provides a clear, powerful API that can be used to generate audio and I’m looking forward making some stuff with it. I’m wondering how it compares to the Audio Unit impementation performance-wise, or if there’s no difference at all because a core audio implementation is hiding under the hood of the two new AVAudioNodes.&lt;/p&gt;

&lt;p&gt;I guess the question now (and pretty much always in time critical systems) is: &lt;em&gt;how far can we go without writing C&lt;/em&gt;?&lt;/p&gt;

&lt;p&gt;Feel free to &lt;a href=&quot;mailto:orjpap@gmail.com&quot;&gt;contact me&lt;/a&gt; or tweet to me on &lt;a href=&quot;https://twitter.com/orjpap&quot;&gt;Twitter&lt;/a&gt; if you have any additional tips or feedback.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">Apple introduced AVAudioSourceNode and AVAudioSinkNode in WWDC2019. These two new AVAudio nodes are part of the AVFoundation framework and can be used in macOS 10.15 and iOS 13 onwards.</summary></entry><entry><title type="html">AVAudioSourceNode, AVAudioSinkNode or How I Deleted a Repo in Less Than 24 hours</title><link href="/swift/real-time/audio/avfoundation/2020/05/19/processAudio.html" rel="alternate" type="text/html" title="AVAudioSourceNode, AVAudioSinkNode or How I Deleted a Repo in Less Than 24 hours" /><published>2020-05-19T07:33:36+03:00</published><updated>2020-05-19T07:33:36+03:00</updated><id>/swift/real-time/audio/avfoundation/2020/05/19/processAudio</id><content type="html" xml:base="/swift/real-time/audio/avfoundation/2020/05/19/processAudio.html">&lt;p&gt;Two days ago, I set out to create a simple Swift library for real-time audio processing. I was aiming to provide an easy to setup way of &lt;strong&gt;processing input&lt;/strong&gt; from an audio device/file, and &lt;strong&gt;generating output&lt;/strong&gt; to a device/file, sample by sample.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://audiokit.io&quot;&gt;AudioKit&lt;/a&gt; which is an audio toolkit for iOS, macOS, and tvOS, offers a well documented Swift API but is a big dependency to add to a project if you only need to perform these tasks.&lt;/p&gt;

&lt;p&gt;On the other hand, &lt;strong&gt;Core Audio&lt;/strong&gt; (initially released in 2003), Apple’s lowest level of abstraction audio framework, clearly states on the front page of its &lt;a href=&quot;https://developer.apple.com/documentation/coreaudio&quot;&gt;documentation&lt;/a&gt;: “Use the Core Audio framework to interact with device’s audio hardware.”. Being so close to hardware comes with a lot of &lt;strong&gt;responsibilities&lt;/strong&gt; and responsibilities mean &lt;strong&gt;boilerplate&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Finally, last time I checked™, &lt;a href=&quot;https://developer.apple.com/av-foundation/&quot;&gt;AVFoundation&lt;/a&gt; was too high-level for these tasks.&lt;/p&gt;

&lt;p&gt;So I took a copy of Chris Adamson’s &lt;a href=&quot;https://www.amazon.com/Learning-Core-Audio-Hands-Programming/dp/0321636848&quot;&gt;Learning Core Audio&lt;/a&gt; book off of my dusty electronic bookshelf and started digging into &lt;strong&gt;Audio Units&lt;/strong&gt;. An audio unit is a software object that performs some sort of work on a stream of audio, frame by frame&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;. In order to generate sound we need to fill a buffer with (typically) 32-bit floating point values ranging between -1.0, 1.0. The stream of these values can be used to describe the displacement of the speaker’s cone in time, which then produces displacement in air particles which are perceived by our ears as sounds. This work is executed on a real-time high priority thread and is usually referred to as a render block or process block. For a more in-depth explanation &lt;a href=&quot;https://docs.cycling74.com/max5/tutorials/msp-tut/mspdigitalaudio.html&quot;&gt;read this.&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;processaudio&quot;&gt;ProcessAudio&lt;/h2&gt;

&lt;p&gt;The hello world of audio generators is a &lt;strong&gt;sinewave&lt;/strong&gt;. But let’s make some &lt;strong&gt;noise&lt;/strong&gt; instead. In order to do so using the Audio Units API we need to:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Find the default output audio component&lt;/li&gt;
  &lt;li&gt;Create a new instance of an audio unit and attach it to the default output&lt;/li&gt;
  &lt;li&gt;Set the renderBlock property of the audio unit to our &lt;strong&gt;noise generator&lt;/strong&gt;: A function that returns a random 32-bit floating point number in the closed range [-1.0, 1.0].&lt;/li&gt;
  &lt;li&gt;Start the audio unit&lt;/li&gt;
  &lt;li&gt;Sleep on the current thread so that we can hear the audio being generated on the real-time thread.&lt;/li&gt;
  &lt;li&gt;Clean up the audio unit&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Even though the Audio Units API is accessible by Swift, it’s a C API, the setup spans almost 70 lines of code and it looks like &lt;a href=&quot;https://www.cocoawithlove.com/2010/10/ios-tone-generator-introduction-to.html&quot;&gt;this&lt;/a&gt;. So I created a wrapper around this setup code that could be used like so:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;whiteNoise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Float&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;device&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;ProcessAudio&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;defaultOutput&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;device&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufferSize&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frameNumber&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufferSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frameNumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;whiteNoise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;device&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;device&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And that was the birth of &lt;strong&gt;ProcessAudio&lt;/strong&gt;. I turned it into a Swift Package using SPM, wrote some tests, made sure it compiles in both macOS and iOS and took notes on how I can improve and expand the API.&lt;/p&gt;

&lt;h2 id=&quot;avaudionodes&quot;&gt;AVAudioNodes&lt;/h2&gt;

&lt;p&gt;Everything was going according to plan, until I found out about &lt;strong&gt;AVAudioSourceNode&lt;/strong&gt; and &lt;strong&gt;AVAudioSinkNode&lt;/strong&gt; that were &lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2019/510&quot;&gt;introduced&lt;/a&gt; in WWDC2019. These two new AVAudio nodes are part of the &lt;a href=&quot;https://developer.apple.com/documentation/avfoundation&quot;&gt;AVFoundation&lt;/a&gt; framework and can be used in macOS 10.15 and iOS 13 onwards.&lt;/p&gt;

&lt;p&gt;AVAudioSourceNode &lt;em&gt;sends&lt;/em&gt; audio to an AVAudioEngine node. The audio is computed in a callback and can be rendered in real-time or offline modes.&lt;/p&gt;

&lt;p&gt;AVAudioSinkNode &lt;em&gt;receives&lt;/em&gt; audio from an AVAudioEngine node. The audio is processed in a callback and can be rendered in real-time or offline modes.&lt;/p&gt;

&lt;p&gt;The following code outputs five seconds of white noise using an AVAudioSourceNode:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AVFoundation&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;whiteNoise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Float&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;whiteNoiseGenerator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AVAudioSourceNode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;silence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frameCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;audioBufferList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;OSStatus&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ablPointer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UnsafeMutableAudioBufferListPointer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;audioBufferList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frameCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;whiteNoise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ablPointer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UnsafeMutableBufferPointer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UnsafeMutableBufferPointer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;noErr&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;engine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AVAudioEngine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;whiteNoiseGenerator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;whiteNoiseGenerator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainMixerNode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainMixerNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outputVolume&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;try!&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The API addresses the exact same points that I wanted to address by making ProcessAudio and it actually looks very similar! How nice.&lt;/p&gt;

&lt;p&gt;Two things might baffle Swift programmers in this example:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;UnsafeMutableAudioBufferListPointer&lt;/strong&gt; and &lt;strong&gt;UnsafeMutableBufferPointer&lt;/strong&gt;.&lt;/p&gt;

    &lt;p&gt;By default, Swift is memory safe: It prevents direct access to memory and makes sure you’ve initialized everything before you use it. But you can also use &lt;em&gt;unsafe Swift&lt;/em&gt;, which lets you access memory directly through pointers. In this example we use an UnsafeMutableBufferPointer instance in low level operations to eliminate uniqueness checks and bounds checks. I recommend reading &lt;a href=&quot;https://pfandrade.me/blog/unsafe-swift/&quot;&gt;Unsafe Swift&lt;/a&gt; by Paulo Andrande to get a better understanding of the unsafe side of Swift.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The &lt;strong&gt;OSStatus&lt;/strong&gt; return type.&lt;/p&gt;

    &lt;p&gt;Almost every Apple C API function signals success or failure through their return value, which is of type OSStatus. Any status other than noErr (which is 0) signals an error. You can find more details &lt;a href=&quot;https://www.osstatus.com/search/results?platform=all&amp;amp;framework=all&amp;amp;search=&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;why-unsafe-swift&quot;&gt;Why unsafe Swift?&lt;/h2&gt;

&lt;p&gt;First of all unsafe Swift lets you work with &lt;a href=&quot;https://codeburst.io/pointers-in-5-minutes-b94f9d1dfdb5&quot;&gt;pointers&lt;/a&gt; and interoprate with C libraries.&lt;/p&gt;

&lt;p&gt;In addition, unsafe Swift can help you gain a performance boost by sacrificing memory safety. The code you write in the AVAudioSourceNode’s block &lt;em&gt;must be realtime compliant&lt;/em&gt;. Your callback is called in a real-time thread with a hard deadline. @44,1khz sampling rate with a buffer size of 512 samples gives you ~11ms to complete processing in your callback. If that’s not the case, you get silence. That time limit prohibits:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Memory Allocations&lt;/li&gt;
  &lt;li&gt;Using Locks&lt;/li&gt;
  &lt;li&gt;Network Requests or any kind of I/O&lt;/li&gt;
  &lt;li&gt;Memory boundary checks/uniqueness checks&lt;/li&gt;
  &lt;li&gt;Checking your Twitter&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Check out &lt;a href=&quot;https://github.com/apple/swift/blob/master/docs/OptimizationTips.rst&quot;&gt;this guide&lt;/a&gt; on writing high-performance Swift code.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;The only reason for ProcessAudio to exist as a library, would be to be used in older iOS and macOS versions. However, I think I can delete the repo without destroying the world as we know it. I really enjoyed the process and picked up a few lessons along the way.&lt;/p&gt;

&lt;p&gt;AVFoundation really suprised me. It provides a clear, powerful API that can be used to generate audio and I’m looking forward making some stuff with it. I’m wondering how it compares to the Audio Unit impementation performance-wise, or if there’s no difference at all because a core audio implementation is hiding under the hood of the two new AVAudioNodes.&lt;/p&gt;

&lt;p&gt;I guess the question now (and pretty much always in real time systems) is: &lt;em&gt;how far can we go without writing C&lt;/em&gt;?&lt;/p&gt;

&lt;p&gt;Feel free to &lt;a href=&quot;mailto:orjpap@gmail.com&quot;&gt;contact me&lt;/a&gt; or tweet to me on &lt;a href=&quot;https://twitter.com/orjpap&quot;&gt;Twitter&lt;/a&gt; if you have any additional tips or feedback.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;A &lt;em&gt;sample&lt;/em&gt; is single numerical value for a single audio channel in an audio stream.. A &lt;em&gt;frame&lt;/em&gt; is a collection of time-coincident samples. For instance, a linear PCM stereo sound file has two samples per frame, one for the left channel and one for the right channel.) &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">Two days ago, I set out to create a simple Swift library for real-time audio processing. I was aiming to provide an easy to setup way of processing input from an audio device/file, and generating output to a device/file, sample by sample.</summary></entry><entry><title type="html">Jekyll: Testing Swift Code Blocks</title><link href="/jekyll/swift/testing/2020/05/04/iOS-doctest-jekyll.html" rel="alternate" type="text/html" title="Jekyll: Testing Swift Code Blocks" /><published>2020-05-04T18:33:36+03:00</published><updated>2020-05-04T18:33:36+03:00</updated><id>/jekyll/swift/testing/2020/05/04/iOS-doctest-jekyll</id><content type="html" xml:base="/jekyll/swift/testing/2020/05/04/iOS-doctest-jekyll.html">&lt;p&gt;Reading through last week’s &lt;a href=&quot;https://iosdevweekly.com&quot;&gt;iOSDevWeekly&lt;/a&gt; I came across &lt;a href=&quot;https://github.com/SwiftDocOrg/DocTest?utm_campaign=iOS%2BDev%2BWeekly&amp;amp;utm_medium=web&amp;amp;utm_source=iOS%2BDev%2BWeekly%2BIssue%2B454&quot;&gt;Doctest&lt;/a&gt;, an exciting new project that aims to make Swift documentation &lt;strong&gt;testable&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;The idea is, you can run &lt;code class=&quot;highlighter-rouge&quot;&gt;swift-doctest&lt;/code&gt; giving it a bunch of .swift files and then it &lt;strong&gt;evaluates&lt;/strong&gt; code blocks in your documentation, returning test results for the given conditions.&lt;/p&gt;

&lt;p&gt;It turns out that you can run &lt;code class=&quot;highlighter-rouge&quot;&gt;swift-doctest&lt;/code&gt; on &lt;strong&gt;Markdown&lt;/strong&gt; files too. What if, we could inject a nice little &lt;code class=&quot;highlighter-rouge&quot;&gt;swift-doctest&lt;/code&gt; every time jekyll renders our static website? That way we can &lt;strong&gt;test codeblocks&lt;/strong&gt; in blog posts and even get it done &lt;strong&gt;automatically on every build&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;install-doctest&quot;&gt;Install DocTest&lt;/h2&gt;

&lt;p&gt;Via Homebrew:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;brew &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;swiftdocorg/formulae/swift-doctest
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or Manually:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/SwiftDocOrg/DocTest
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;DocTest
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;jekyll-hook&quot;&gt;Jekyll Hook&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;note: these are my first 6 lines of Ruby, please be gentle with me&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Put this in a file called swift-doctest.rb on a _plugins folder in your blog root foolder&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Jekyll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Hooks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:pre_render&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'doctest'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sx&quot;&gt;%x( echo;echo 'swift-doctest for &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;';swift-doctest &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;; echo;)&lt;/span&gt;
		&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This &lt;a href=&quot;https://jekyllrb.com/docs/plugins/hooks/&quot;&gt;Jekyl Hook&lt;/a&gt; runs every time your site is built, &lt;strong&gt;before&lt;/strong&gt; the .md files get rendered to .html files. I put it at this point so that I can do something more sophisticated in the future by probably injecting some html to show me the failed test results.&lt;/p&gt;

&lt;p&gt;In order to enable swift-doctest for a post, add &lt;code class=&quot;highlighter-rouge&quot;&gt;doctest: true&lt;/code&gt; to the post’s front matter.&lt;/p&gt;

&lt;h2 id=&quot;take-it-for-a-spin&quot;&gt;Take it for a spin&lt;/h2&gt;

&lt;p&gt;Start a codeblock with &lt;strong&gt;```swift doctest&lt;/strong&gt; and then, add an annotation in the format &lt;code class=&quot;highlighter-rouge&quot;&gt;=&amp;gt; (Type) = (Value)&lt;/code&gt;, to test the expected type and value of the expression:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Foo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;anotherUser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Bar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;anotherUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// =&amp;gt; Bool = true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now if you run &lt;code class=&quot;highlighter-rouge&quot;&gt;bundle exec jekyll serve&lt;/code&gt; to build and serve your site, the terminal will print a failed test in the &lt;a href=&quot;https://testanything.org&quot;&gt;TAP format&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...

swift-doctest &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &amp;lt;path_to_your_blog&amp;gt;/_posts/&amp;lt;blog_post_filename&amp;gt;.md
TAP version 13
1..2
not ok 1 - &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;user.name &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; anotherUser.name&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; produces &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;Bool &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;, expected &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;Bool &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
  column: 37
  file: &amp;lt;path_to_your_blog&amp;gt;/_posts/&amp;lt;blog_post_filename&amp;gt;.md
  line: 6
  ...
  
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nice! If you just change the example to:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Foo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;anotherUser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Bar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;anotherUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// =&amp;gt; Bool = false&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And just save the file, you will see:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...

swift-doctest &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &amp;lt;path_to_your_blog&amp;gt;/_posts/&amp;lt;blog_post_filename&amp;gt;.md
TAP version 13
1..1
ok 1 - &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;user.name &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; anotherUser.name&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; produces &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;Bool &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
  column: 36
  file: &amp;lt;path_to_your_blog&amp;gt;/_posts/&amp;lt;blog_post_filename&amp;gt;.md
  line: 6
  ...
  
...

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;That’s all you need in order to enable testing for Swift codeblocks in your Jekyll site!&lt;/p&gt;

&lt;p&gt;Keep your eyes peeled for further updates to the very promising &lt;a href=&quot;https://github.com/SwiftDocOrg/DocTest?utm_campaign=iOS%2BDev%2BWeekly&amp;amp;utm_medium=web&amp;amp;utm_source=iOS%2BDev%2BWeekly%2BIssue%2B454&quot;&gt;Doctest&lt;/a&gt; since it’s still on its early days.&lt;/p&gt;

&lt;p&gt;Feel free to &lt;a href=&quot;mailto:orjpap@gmail.com&quot;&gt;contact me&lt;/a&gt; or tweet to me on &lt;a href=&quot;https://twitter.com/orjpap&quot;&gt;Twitter&lt;/a&gt; if you have any additional tips or feedback.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">Reading through last week’s iOSDevWeekly I came across Doctest, an exciting new project that aims to make Swift documentation testable.</summary></entry><entry><title type="html">Podfast: a Podcast Discovery App</title><link href="/product/design/swift/ios/2020/05/02/iOS-podfast-edit.html" rel="alternate" type="text/html" title="Podfast: a Podcast Discovery App" /><published>2020-05-02T18:33:36+03:00</published><updated>2020-05-02T18:33:36+03:00</updated><id>/product/design/swift/ios/2020/05/02/iOS-podfast-edit</id><content type="html" xml:base="/product/design/swift/ios/2020/05/02/iOS-podfast-edit.html">&lt;p&gt;I can clearly recall my mother’s disappointment once she realised she couldn’t listen to the radio through her new iPhone. Which made total sense to me.&lt;/p&gt;

&lt;p&gt;At the time there was only a built-in app called &lt;a href=&quot;https://apps.apple.com/us/app/apple-podcasts/id525463029&quot;&gt;Podcasts&lt;/a&gt; that allowed you to listen to podcasts. Also, Generation Z’s complete lack of interest in the radio experience had already signaled the start of a new era. Podcasting, once an obscure process of transmitting audio content, had now become a distinguished medium for its distribution.&lt;/p&gt;

&lt;p&gt;When old media are replaced by new ones, some of their features are dropped ‘cause they no longer serve a purpose. Podfast was inspired by the original process of discovering new radio stations through AM/FM &lt;strong&gt;scanning&lt;/strong&gt;, a process so undoubtedly joyous and adventuresome for quite a few people that there’s even a hobby invented for indulging in it, called &lt;a href=&quot;https://en.wikipedia.org/wiki/DXing&quot;&gt;DXing&lt;/a&gt;. My idea was that the concept of radio discovery can incorporate so much more user value than just the induction of nostalgic feelings to the users (like, creating a typewriter app does, for example). Since ideas transcend media, its &lt;strong&gt;essence&lt;/strong&gt; could be rebottled and repurposed for the Podcast era and even be further expanded.&lt;/p&gt;

&lt;p&gt;I thought hard on the radio discovery process and I found that the main characteristics defining it are:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Chance:&lt;/strong&gt; In case you don’t tune in to your favourite program in time, chance is always involved in the program you will tune in to eventually, also in its elapsed time.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Audio Cues&lt;/strong&gt;: instead of visual cues. Even though you can see which frequency corresponds to a specific position of the knob, only the audio provides you with information about whether you are going to like what you hear or not.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Locality&lt;/strong&gt;: When you move to another country or region, you will tune in to entirely different stations.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;implementation&quot;&gt;Implementation&lt;/h2&gt;

&lt;p&gt;Getting started, at the top level, I described what I was trying to build in the form of a simple &lt;strong&gt;user story&lt;/strong&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;As a listener I want to discover podcasts by scrolling while listening to them&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This was pretty much it. This single user story has since spawned a lot of other stories, tasks, sub-tasks etc. These sub-stories all revolve around the three above-mentioned characteristics. The process was:
(a) think of a scenario
(b) write code that implements it
(c) assess the value it adds for the user
(d) integrate it into the app. That’s how I made an iOS app &lt;strong&gt;prototype&lt;/strong&gt; pretty quickly, implementing this user story into local podcast audio files and just a &lt;a href=&quot;https://developer.apple.com/documentation/uikit/uislider&quot;&gt;UISlider&lt;/a&gt;.&lt;/p&gt;

&lt;video controls=&quot;&quot; width=&quot;320&quot; height=&quot;576&quot;&gt;
  &lt;source src=&quot;/assets/images/2019-14-20-podfast.assets/podfast_early_prototype.mp4&quot; /&gt;
Your browser does not support the video tag.
&lt;/video&gt;

&lt;p&gt;My next step was to use some real &lt;strong&gt;data sources&lt;/strong&gt;. I turned to &lt;a href=&quot;https://rss.itunes.apple.com/en-us&quot;&gt;iTunes RSS Feed Generator&lt;/a&gt;, a publicly accessible API which returns a &lt;a href=&quot;https://rss.itunes.apple.com/api/v1/gr/podcasts/top-podcasts/all/100/explicit.json&quot;&gt;JSON file&lt;/a&gt; with the Top 100 Podcasts in different regions, regularly updated on an almost weekly basis. After collecting this data I had to jump through some hoops - I won’t bore you with the details - to get the metadata for each podcast (XML RSS feed parsing anyone? 😁) but thankfully, the podcast RSS feed tags are properly standardized in order to get parsed by iTunes, Spotify etc.&lt;/p&gt;

&lt;p&gt;At this point, I realised that the less the app’s core logic knows about the &lt;strong&gt;specifics&lt;/strong&gt; of the various data sources, the better for the app. To achieve this separation, I spent some weeks researching the most common app architecture patterns and ended up re-writing my hacky/scripty view controller logic by using something very similar to &lt;a href=&quot;https://www.objc.io/issues/13-architecture/viper/&quot;&gt;Viper&lt;/a&gt; and &lt;a href=&quot;https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html&quot;&gt;Uncle Bob’s clean architecture&lt;/a&gt; but not exactly any of them. For those of you who are interested, you can take a look at the folder called &lt;a href=&quot;https://github.com/orjpap/podfast/tree/master/PodFast/Use%20Cases/Discovery&quot;&gt;Use Cases&lt;/a&gt; and let me know what you think (I’m suspecting I have committed some over-abstraction crimes here). Anyway, my goal behind all this was very clear: I wanted to be able to &lt;strong&gt;switch data sources&lt;/strong&gt; on a whim, without having to re-write half of my app. This proved to be very valuable when remote configuration feeding podcast data was added.&lt;/p&gt;

&lt;p&gt;I also noticed that podcasts could be organised &lt;strong&gt;by category&lt;/strong&gt; and that was pretty neat, since such a minimal visual cue is not prominent enough to distract the user from &lt;strong&gt;listening&lt;/strong&gt;. Finally, I replaced the slider with a &lt;a href=&quot;https://developer.apple.com/documentation/uikit/uicollectionview&quot;&gt;UICollectionView&lt;/a&gt; to display the category names and also wrote some simple collision logic:&lt;/p&gt;

&lt;video controls=&quot;&quot; width=&quot;320&quot; height=&quot;576&quot;&gt;
  &lt;source src=&quot;/assets/images/2019-14-20-podfast.assets/podfast_early_prototype2.mp4&quot; /&gt;
Your browser does not support the video tag.
&lt;/video&gt;

&lt;p&gt;That was the &lt;strong&gt;prototype&lt;/strong&gt; I showed to the visual artist/writer Vasia Bakogianni, also known as &lt;a href=&quot;https://www.kroutsef.com&quot;&gt;@kroutsef&lt;/a&gt; and asked her to work as a &lt;strong&gt;graphic designer&lt;/strong&gt; for the app. She took it all in and we got straight to work. After a few interesting conversations, brainstorming sessions and design iterations she came up with the &lt;strong&gt;app icon&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-podfast.assets/podfast_logo.PNG&quot; alt=&quot;podfast_logo&quot; style=&quot;zoom:50%;&quot; class=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vasia has not only worked as a designer for the project, but since she is an avid podcast listener, she has also provided valuable feedback on the user experience, as well as hours of interesting app and non-app related conversations. After taking a &lt;strong&gt;short break&lt;/strong&gt;, where we had to work on various other projects, we got back to ‘Podfast’ and decided to push towards the app release by setting a strict release date. Since we’d done a lot of groundwork and the concept had already been solidified, we finalized the &lt;strong&gt;designing&lt;/strong&gt; aspect of it shortly after:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-podfast.assets/design_screenshot.png&quot; alt=&quot;design_screenshot&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From a software perspective we agreed on a &lt;strong&gt;subset&lt;/strong&gt; of features that would be included in the release, a sort of minimum viable product (&lt;strong&gt;MVP&lt;/strong&gt;) approach, based on the following principle: before making a significant time and effort investment we have to set out to release the product, deliver it to the users and then channel their input back into the process of development.&lt;/p&gt;

&lt;p&gt;Shortly prior to the big release, I realised that since there is &lt;strong&gt;streaming&lt;/strong&gt; involved and the loading time experience ranges from “seemingly instant” to “slower than death caused by a natural cause”, we needed a way to indicate the &lt;strong&gt;buffering state&lt;/strong&gt;. We decided to go with something different from the established spinner/loader pattern and use &lt;strong&gt;radio static sounds&lt;/strong&gt;. The current, simplified implementation has a static sound sample played when &lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avplayer&quot;&gt;AVPlayer&lt;/a&gt; is &lt;a href=&quot;https://github.com/orjpap/podfast/blob/120ef148529dfffed1151919402ca0022014a85d/PodFast/Use%20Cases/Discovery/AudioPlayer.swift#L118-L188&quot;&gt;having a rough time&lt;/a&gt; buffering. Of course, there is definitely room for improvement by obviously inserting &lt;strong&gt;procedural sound design&lt;/strong&gt; into the concept. Spinners are the ultimate playground for graphic designers, so let’s also give sound designers the opportunity to indicate &lt;strong&gt;loading states&lt;/strong&gt;.&lt;/p&gt;

&lt;video controls=&quot;&quot; width=&quot;320&quot; height=&quot;576&quot;&gt;
  &lt;source src=&quot;/assets/images/2019-14-20-podfast.assets/streaming_static.mp4&quot; /&gt;
Your browser does not support the video tag.
&lt;/video&gt;

&lt;p&gt;Over a period of one week and a few micro-features later, some of which are:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Categories are sorted out by “most listened”&lt;/li&gt;
  &lt;li&gt;A listen is defined as “1 minute of listening”&lt;/li&gt;
  &lt;li&gt;Podcast details appear after 30 seconds of listening to a podcast, in order to encourage the listener to pay attention to the audio.&lt;/li&gt;
  &lt;li&gt;The episode seek time is related to the app’s start time.&lt;/li&gt;
  &lt;li&gt;Curated podcast sources can by dynamically added to the data set. Thanks to &lt;a href=&quot;https://firebase.google.com/docs/remote-config&quot;&gt;Firebase Remote Configuration&lt;/a&gt;,&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;we finally had our &lt;strong&gt;1.0 release&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/podfast_portfolio_halfsize_15.gif&quot; alt=&quot;podfast_gif&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;where-to-next&quot;&gt;Where to next?&lt;/h2&gt;

&lt;p&gt;You can download the app for free from the App Store and give it a try.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://apps.apple.com/us/app/podfast/id1507685149?ls=1&quot;&gt;&lt;img src=&quot;/assets/images/download_on_the_app_store.svg&quot; class=&quot;appstoreDownload&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Our users have already done a great job sharing their feedback with us. We are bound to release an update soon, with improved features that were assimilated thanks to their suggestions. We would also love to hear your own &lt;strong&gt;feedback&lt;/strong&gt; on the app &lt;a href=&quot;mailto:orjpap@gmail.com&quot;&gt;Send us an email&lt;/a&gt; or get in touch on Twitter &lt;a href=&quot;https://twitter.com/orjpap&quot;&gt;@orjpap&lt;/a&gt;, &lt;a href=&quot;https://twitter.com/vasiabakogianni&quot;&gt;@kroutsef&lt;/a&gt;. Feel free to share with us your favourite podcasts and the category they belong to as well, so we can add them to our collection.&lt;/p&gt;

&lt;p&gt;There is still a lot to learn and improve, so further optimization in the departments of &lt;strong&gt;streaming logic&lt;/strong&gt;, &lt;strong&gt;sound design&lt;/strong&gt; and &lt;strong&gt;visuals&lt;/strong&gt; of the app is inevitable. Besides, we’re planning to introduce the parameter of &lt;strong&gt;locality&lt;/strong&gt; mentioned above. Instead of just selecting from the US Top 100 and our curated podcasts, the user will be able to discover podcasts that are popular in their respective country.&lt;/p&gt;

&lt;p&gt;An &lt;strong&gt;Android app&lt;/strong&gt; is also in the making by &lt;a href=&quot;https://github.com/Pkoutsokeras&quot;&gt;Petros Koutsokeras&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The &lt;strong&gt;source code&lt;/strong&gt; is available for free and can be found on &lt;a href=&quot;https://github.com/orjpap/podfast&quot;&gt;Github&lt;/a&gt;, I’m open to discussions about the implementation/architecture of the app and points that can and should be improved.&lt;/p&gt;

&lt;p&gt;To sum up, I will just quote Vasia’s carefully crafted words:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Podfast is, after all, not a digital radio simulation that aspires to send you on a nostalgia trip. It is a tool that re-establishes the user trust in a carefully selected bunch of cultural products picked by the users themselves without strain.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">I can clearly recall my mother’s disappointment once she realised she couldn’t listen to the radio through her new iPhone. Which made total sense to me.</summary></entry><entry><title type="html">How to Set Up Xcode Build Configurations</title><link href="/xcode/ios/swift/cocoapods/2020/04/20/iOS-build-schemes.html" rel="alternate" type="text/html" title="How to Set Up Xcode Build Configurations" /><published>2020-04-20T18:33:36+03:00</published><updated>2020-04-20T18:33:36+03:00</updated><id>/xcode/ios/swift/cocoapods/2020/04/20/iOS-build-schemes</id><content type="html" xml:base="/xcode/ios/swift/cocoapods/2020/04/20/iOS-build-schemes.html">&lt;p&gt;Build configurations are useful for a handful of reasons. If you are developing an app that’s currently in production, chances are you are switching from your production API endpoints to some kind of &lt;strong&gt;test environment&lt;/strong&gt; endpoints for development. Of course you can do the “comment/uncomment URL constants” dance everytime you need to &lt;strong&gt;switch environments&lt;/strong&gt;, but other than being a tedious and error-prone process there are cases where build configurations are unavoidable.&lt;/p&gt;

&lt;p&gt;Take &lt;strong&gt;automated builds&lt;/strong&gt; for example, be it custom nightly build scripts or some ultra-fancy CI pipeline. The number one rule of automated build is that you have to be able to produce a build for your project with a &lt;em&gt;“single command”&lt;/em&gt;. Which is not the case if you need to comment/uncomment lines every time you build in order to point to the correct environment.&lt;/p&gt;

&lt;p&gt;Unfortunately (at the time of writing this post) the way to set up build configurations in Xcode is not very straightforward and it certainly does not feel as user friendly as other Xcode features. But let’s dive into it.&lt;/p&gt;

&lt;h2 id=&quot;create-a-configuration-file&quot;&gt;Create a Configuration File&lt;/h2&gt;

&lt;p&gt;Go to &lt;strong&gt;File -&amp;gt; New -&amp;gt; File&lt;/strong&gt; (or cmd + N) and select the &lt;strong&gt;“Configuration Settings File”&lt;/strong&gt; template.&lt;/p&gt;

&lt;p&gt;A Configuration Settings File (a file with a &lt;code class=&quot;highlighter-rouge&quot;&gt;.xcconfig&lt;/code&gt; file extension) is a plain text file that defines and overrides the &lt;a href=&quot;https://help.apple.com/xcode/mac/11.4/#/dev382dac089&quot;&gt;build settings&lt;/a&gt; for a particular build configuration of a project or target.&lt;/p&gt;

&lt;p&gt;We’ll create one file for Production, called &lt;strong&gt;Production.xcconfig&lt;/strong&gt; and another one for Development called… you guessed it, &lt;strong&gt;Development.xcconfig&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;define-build-variables&quot;&gt;Define &lt;strong&gt;build variables&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;Let’s say that we want to be able to configure a backend endpoint and the app’s display name.&lt;/p&gt;

&lt;p&gt;We can add the following to Production.xcconfig:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;BACKEND_URL &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; https:/&lt;span class=&quot;si&quot;&gt;$()&lt;/span&gt;/my.production.api/v1
APP_NAME &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Production
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and Development.xcconfig&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;BACKEND_URL &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; https:/&lt;span class=&quot;si&quot;&gt;$()&lt;/span&gt;/my.test.api/v1
APP_NAME &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Development
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;$() denotes an &lt;strong&gt;empty variable substitution&lt;/strong&gt;. It’s used in order to escape the double dash so that the part following it is not treated as a comment. A minor annoyance, but quite handy when you know it!&lt;/p&gt;

&lt;p&gt;Another way to go about customising &lt;u&gt;existing&lt;/u&gt; target build settings is to override settings such as PRODUCT_NAME. I do not prefer this approach since dealing with build setting levels and inheritance can be a tedious. Instead, I use only new variable names and assign them to the corresponding values in info.plist (more on that later)&lt;/p&gt;

&lt;h2 id=&quot;create-new-build-configurations&quot;&gt;Create New Build Configurations&lt;/h2&gt;

&lt;p&gt;Press the “+” icon and select which basic configuration you want to duplicate, release or debug in this case. I will go for release for Production and debug for Development.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-iOS-build-schemes.assets/1-7397814.png&quot; alt=&quot;1-7397814&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Then select which configuration file this build configuration is based on. You can define this for the whole project or for specific targets.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-iOS-build-schemes.assets/2.png&quot; alt=&quot;2&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;assign-build-configurations&quot;&gt;Assign Build Configurations&lt;/h2&gt;

&lt;p&gt;Now if we navigate to &lt;strong&gt;“Edit Scheme”&lt;/strong&gt; for the current scheme, our just defined build configurations are avaiable to select for the different actions.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-iOS-build-schemes.assets/3.png&quot; alt=&quot;3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If it wasn’t for &lt;strong&gt;cocoapods&lt;/strong&gt; our project would build and run right now, but we’ll deal with that later. First let’s make some custom schemes so that we can easily switch between the various build configurations.&lt;/p&gt;

&lt;h2 id=&quot;create-custom-schemes&quot;&gt;Create Custom Schemes&lt;/h2&gt;

&lt;p&gt;I usually delete (select and click on the “-“ icon) the default scheme and create new ones for each configuration. From the “manage schemes” menu, let’s create two new schemes named &lt;strong&gt;Production&lt;/strong&gt; and &lt;strong&gt;Development&lt;/strong&gt; using the default target. Don’t forget to edit the schemes to run the corresponding build configuration on &lt;u&gt;Run&lt;/u&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-iOS-build-schemes.assets/4.png&quot; alt=&quot;4&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cocoapods&quot;&gt;Cocoapods&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;If you are not using cocoapods you can skip this section.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In order to make cocoapods integrate nicely with our custom build configurations we need to:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Add custom build configurations to PodFile&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;Specify where your build configuration is derived from so that Cocoapods can create its own build configuration for the project’s dependencies&lt;/p&gt;

    &lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;project 'BuildConfigurationsTutorial', 'Production' =&amp;gt; :release, 'Development' =&amp;gt; :debug&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Run pod install from the root of your project&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;Open up a terminal in the root directory of your project and run:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nv&quot;&gt;$:&lt;/span&gt; pod &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Cocoapods will create its own .xcconfig files located in the &lt;strong&gt;/Pods/Targets Support Files/&amp;lt;Project Name&amp;gt;/&lt;/strong&gt; folder of your workspace. One for each build configuration in the project.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Include the cocoapods build configs in the custom configuration files&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;Configuration files can include other .xcconfig files. In Production.xcconfig add:&lt;/p&gt;

    &lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &quot;Pods/Target Support Files/Pods-BuildConfigurationsTutorial/Pods-BuildConfigurationsTutorial.production.xcconfig&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;And similar for Development.xcconfig&lt;/p&gt;

    &lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &quot;Pods/Target Support Files/Pods-BuildConfigurationsTutorial/Pods-BuildConfigurationsTutorial.development.xcconfig&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;assign-build-variables-to-infoplist&quot;&gt;Assign build variables to info.plist&lt;/h2&gt;

&lt;p&gt;In the project’s info.plist you can assign build variables as values using variable substituion i.e &lt;strong&gt;$(VARIABLE_NAME)&lt;/strong&gt; notation. For the Bundle Name key we can use &lt;strong&gt;$(APP_NAME)&lt;/strong&gt; and we can create a new key (right click + add row) named &lt;strong&gt;BACKEND_URL&lt;/strong&gt; and assign &lt;strong&gt;$(BACKEND_URL)&lt;/strong&gt; to it&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-iOS-build-schemes.assets/5.png&quot; alt=&quot;5&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;access-build-variables-from-code&quot;&gt;Access build variables from code&lt;/h2&gt;

&lt;p&gt;Add the following to a &lt;strong&gt;BuildConfiguration.swift&lt;/strong&gt; file in your project:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;BuildConfiguration&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Swift&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;missingKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;invalidValue&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;LosslessStringConvertible&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Bundle&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forInfoDictionaryKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;missingKey&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fallthrough&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;invalidValue&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;API&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;backendURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;BuildConfiguration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;BACKEND_URL&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;fatalError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localizedDescription&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then anywhere you need to access the backend URL you can access it using the enum static variable&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Backend URL: &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;API&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backendURL&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;build-and-run&quot;&gt;Build and Run&lt;/h2&gt;

&lt;p&gt;Building the Production scheme:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-iOS-build-schemes.assets/6.png&quot; alt=&quot;6&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Building the Development scheme:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-iOS-build-schemes.assets/7.png&quot; alt=&quot;7&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;useful-links&quot;&gt;Useful Links&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/orjpap/XcodeBuildConfigurationsTutorial&quot;&gt;Clone the example in Github&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://help.apple.com/xcode/#/dev745c5c974&quot;&gt;Apple’s Documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://pewpewthespells.com/blog/xcconfig_guide.html&quot;&gt;The unofficial Guide to XcodeConfig&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://nshipster.com/xcconfig/&quot;&gt;NSHipster’s Xcode Build Configuration Files&lt;/a&gt;&lt;/p&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">Build configurations are useful for a handful of reasons. If you are developing an app that’s currently in production, chances are you are switching from your production API endpoints to some kind of test environment endpoints for development. Of course you can do the “comment/uncomment URL constants” dance everytime you need to switch environments, but other than being a tedious and error-prone process there are cases where build configurations are unavoidable.</summary></entry><entry><title type="html">Podfast: a Podcast Discovery App</title><link href="/product/design/swift/ios/2019/05/02/iOS-podfast-edit.html" rel="alternate" type="text/html" title="Podfast: a Podcast Discovery App" /><published>2019-05-02T18:33:36+03:00</published><updated>2019-05-02T18:33:36+03:00</updated><id>/product/design/swift/ios/2019/05/02/iOS-podfast-edit</id><content type="html" xml:base="/product/design/swift/ios/2019/05/02/iOS-podfast-edit.html">&lt;p&gt;I can clearly recall my mother’s disappointment once she realised she couldn’t listen to the radio through her new iPhone. Which made total sense to me.&lt;/p&gt;

&lt;p&gt;At the time there was only a built-in app called &lt;a href=&quot;https://apps.apple.com/us/app/apple-podcasts/id525463029&quot;&gt;Podcasts&lt;/a&gt; that allowed you to listen to podcasts. Also, Generation Z’s complete lack of interest in the radio experience had already signaled the start of a new era. Podcasting, once an obscure process of transmitting audio content, had now become a distinguished medium for its distribution.&lt;/p&gt;

&lt;p&gt;When old media are replaced by new ones, some of their features are dropped ‘cause they no longer serve a purpose. Podfast was inspired by the original process of discovering new radio stations through AM/FM &lt;strong&gt;scanning&lt;/strong&gt;, a process so undoubtedly joyous and adventuresome for quite a few people that there’s even a hobby invented for indulging in it, called &lt;a href=&quot;https://en.wikipedia.org/wiki/DXing&quot;&gt;DXing&lt;/a&gt;. My idea was that the concept of radio discovery can incorporate so much more user value than just the induction of nostalgic feelings to the users (like, creating a typewriter app does, for example). Since ideas transcend media, its &lt;strong&gt;essence&lt;/strong&gt; could be rebottled and repurposed for the Podcast era and even be further expanded.&lt;/p&gt;

&lt;p&gt;I thought hard on the radio discovery process and I found that the main characteristics defining it are:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Chance:&lt;/strong&gt; In case you don’t tune in to your favourite program in time, chance is always involved in the program you will tune in to eventually, also in its elapsed time.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Audio Cues&lt;/strong&gt;: instead of visual cues. Even though you can see which frequency corresponds to a specific position of the knob, only the audio provides you with information about whether you are going to like what you hear or not.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Locality&lt;/strong&gt;: When you move to another country or region, you will tune in to entirely different stations.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;implementation&quot;&gt;Implementation&lt;/h2&gt;

&lt;p&gt;Getting started, at the top level, I described what I was trying to build in the form of a simple &lt;strong&gt;user story&lt;/strong&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;As a listener I want to discover podcasts by scrolling while listening to them&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This was pretty much it. This single user story has since spawned a lot of other stories, tasks, sub-tasks etc. These sub-stories all revolve around the three above-mentioned characteristics. The process was:
(a) think of a scenario
(b) write code that implements it
(c) assess the value it adds for the user
(d) integrate it into the app. That’s how I made an iOS app &lt;strong&gt;prototype&lt;/strong&gt; pretty quickly, implementing this user story into local podcast audio files and just a &lt;a href=&quot;https://developer.apple.com/documentation/uikit/uislider&quot;&gt;UISlider&lt;/a&gt;.&lt;/p&gt;

&lt;video controls=&quot;&quot; width=&quot;320&quot; height=&quot;576&quot;&gt;
  &lt;source src=&quot;/assets/images/2019-14-20-podfast.assets/podfast_early_prototype.mp4&quot; /&gt;
Your browser does not support the video tag.
&lt;/video&gt;

&lt;p&gt;My next step was to use some real &lt;strong&gt;data sources&lt;/strong&gt;. I turned to &lt;a href=&quot;https://rss.itunes.apple.com/en-us&quot;&gt;iTunes RSS Feed Generator&lt;/a&gt;, a publicly accessible API which returns a &lt;a href=&quot;https://rss.itunes.apple.com/api/v1/gr/podcasts/top-podcasts/all/100/explicit.json&quot;&gt;JSON file&lt;/a&gt; with the Top 100 Podcasts in different regions, regularly updated on an almost weekly basis. After collecting this data I had to jump through some hoops - I won’t bore you with the details - to get the metadata for each podcast (XML RSS feed parsing anyone? 😁) but thankfully, the podcast RSS feed tags are properly standardized in order to get parsed by iTunes, Spotify etc.&lt;/p&gt;

&lt;p&gt;At this point, I realised that the less the app’s core logic knows about the &lt;strong&gt;specifics&lt;/strong&gt; of the various data sources, the better for the app. To achieve this separation, I spent some weeks researching the most common app architecture patterns and ended up re-writing my hacky/scripty view controller logic by using something very similar to &lt;a href=&quot;https://www.objc.io/issues/13-architecture/viper/&quot;&gt;Viper&lt;/a&gt; and &lt;a href=&quot;https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html&quot;&gt;Uncle Bob’s clean architecture&lt;/a&gt; but not exactly any of them. For those of you who are interested, you can take a look at the folder called &lt;a href=&quot;https://github.com/orjpap/podfast/tree/master/PodFast/Use%20Cases/Discovery&quot;&gt;Use Cases&lt;/a&gt; and let me know what you think (I’m suspecting I have committed some over-abstraction crimes here). Anyway, my goal behind all this was very clear: I wanted to be able to &lt;strong&gt;switch data sources&lt;/strong&gt; on a whim, without having to re-write half of my app. This proved to be very valuable when remote configuration feeding podcast data was added.&lt;/p&gt;

&lt;p&gt;I also noticed that podcasts could be organised &lt;strong&gt;by category&lt;/strong&gt; and that was pretty neat, since such a minimal visual cue is not prominent enough to distract the user from &lt;strong&gt;listening&lt;/strong&gt;. Finally, I replaced the slider with a &lt;a href=&quot;https://developer.apple.com/documentation/uikit/uicollectionview&quot;&gt;UICollectionView&lt;/a&gt; to display the category names and also wrote some simple collision logic:&lt;/p&gt;

&lt;video controls=&quot;&quot; width=&quot;320&quot; height=&quot;576&quot;&gt;
  &lt;source src=&quot;/assets/images/2019-14-20-podfast.assets/podfast_early_prototype2.mp4&quot; /&gt;
Your browser does not support the video tag.
&lt;/video&gt;

&lt;p&gt;That was the &lt;strong&gt;prototype&lt;/strong&gt; I showed to the visual artist/writer Vasia Bakogianni, also known as &lt;a href=&quot;https://www.kroutsef.com&quot;&gt;@kroutsef&lt;/a&gt; and asked her to work as a &lt;strong&gt;graphic designer&lt;/strong&gt; for the app. She took it all in and we got straight to work. After a few interesting conversations, brainstorming sessions and design iterations she came up with the &lt;strong&gt;app icon&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-podfast.assets/podfast_logo.PNG&quot; alt=&quot;podfast_logo&quot; style=&quot;zoom:50%;&quot; class=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vasia has not only worked as a designer for the project, but since she is an avid podcast listener, she has also provided valuable feedback on the user experience, as well as hours of interesting app and non-app related conversations. After taking a &lt;strong&gt;short break&lt;/strong&gt;, where we had to work on various other projects, we got back to ‘Podfast’ and decided to push towards the app release by setting a strict release date. Since we’d done a lot of groundwork and the concept had already been solidified, we finalized the &lt;strong&gt;designing&lt;/strong&gt; aspect of it shortly after:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2019-14-20-podfast.assets/design_screenshot.png&quot; alt=&quot;design_screenshot&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From a software perspective we agreed on a &lt;strong&gt;subset&lt;/strong&gt; of features that would be included in the release, a sort of minimum viable product (&lt;strong&gt;MVP&lt;/strong&gt;) approach, based on the following principle: before making a significant time and effort investment we have to set out to release the product, deliver it to the users and then channel their input back into the process of development.&lt;/p&gt;

&lt;p&gt;Shortly prior to the big release, I realised that since there is &lt;strong&gt;streaming&lt;/strong&gt; involved and the loading time experience ranges from “seemingly instant” to “slower than death caused by a natural cause”, we needed a way to indicate the &lt;strong&gt;buffering state&lt;/strong&gt;. We decided to go with something different from the established spinner/loader pattern and use &lt;strong&gt;radio static sounds&lt;/strong&gt;. The current, simplified implementation has a static sound sample played when &lt;a href=&quot;https://developer.apple.com/documentation/avfoundation/avplayer&quot;&gt;AVPlayer&lt;/a&gt; is &lt;a href=&quot;https://github.com/orjpap/podfast/blob/120ef148529dfffed1151919402ca0022014a85d/PodFast/Use%20Cases/Discovery/AudioPlayer.swift#L118-L188&quot;&gt;having a rough time&lt;/a&gt; buffering. Of course, there is definitely room for improvement by obviously inserting &lt;strong&gt;procedural sound design&lt;/strong&gt; into the concept. Spinners are the ultimate playground for graphic designers, so let’s also give sound designers the opportunity to indicate &lt;strong&gt;loading states&lt;/strong&gt;.&lt;/p&gt;

&lt;video controls=&quot;&quot; width=&quot;320&quot; height=&quot;576&quot;&gt;
  &lt;source src=&quot;/assets/images/2019-14-20-podfast.assets/streaming_static.mp4&quot; /&gt;
Your browser does not support the video tag.
&lt;/video&gt;

&lt;p&gt;Over a period of one week and a few micro-features later, some of which are:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Categories are sorted out by “most listened”&lt;/li&gt;
  &lt;li&gt;A listen is defined as “1 minute of listening”&lt;/li&gt;
  &lt;li&gt;Podcast details appear after 30 seconds of listening to a podcast, in order to encourage the listener to pay attention to the audio.&lt;/li&gt;
  &lt;li&gt;The episode seek time is related to the app’s start time.&lt;/li&gt;
  &lt;li&gt;Curated podcast sources can by dynamically added to the data set. Thanks to &lt;a href=&quot;https://firebase.google.com/docs/remote-config&quot;&gt;Firebase Remote Configuration&lt;/a&gt;,&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;we finally had our &lt;strong&gt;1.0 release&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/podfast_portfolio_halfsize_15.gif&quot; alt=&quot;podfast_gif&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;where-to-next&quot;&gt;Where to next?&lt;/h2&gt;

&lt;p&gt;You can download the app for free from the App Store and give it a try.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://apps.apple.com/us/app/podfast/id1507685149?ls=1&quot;&gt;&lt;img src=&quot;/assets/images/download_on_the_app_store.svg&quot; class=&quot;appstoreDownload&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Our users have already done a great job sharing their feedback with us. We are bound to release an update soon, with improved features that were assimilated thanks to their suggestions. We would also love to hear your own &lt;strong&gt;feedback&lt;/strong&gt; on the app &lt;a href=&quot;mailto:orjpap@gmail.com&quot;&gt;Send us an email&lt;/a&gt; or get in touch on Twitter &lt;a href=&quot;https://twitter.com/orjpap&quot;&gt;@orjpap&lt;/a&gt;, &lt;a href=&quot;https://twitter.com/vasiabakogianni&quot;&gt;@kroutsef&lt;/a&gt;. Feel free to share with us your favourite podcasts and the category they belong to as well, so we can add them to our collection.&lt;/p&gt;

&lt;p&gt;There is still a lot to learn and improve, so further optimization in the departments of &lt;strong&gt;streaming logic&lt;/strong&gt;, &lt;strong&gt;sound design&lt;/strong&gt; and &lt;strong&gt;visuals&lt;/strong&gt; of the app is inevitable. Besides, we’re planning to introduce the parameter of &lt;strong&gt;locality&lt;/strong&gt; mentioned above. Instead of just selecting from the US Top 100 and our curated podcasts, the user will be able to discover podcasts that are popular in their respective country.&lt;/p&gt;

&lt;p&gt;An &lt;strong&gt;Android app&lt;/strong&gt; is also in the making by &lt;a href=&quot;https://github.com/Pkoutsokeras&quot;&gt;Petros Koutsokeras&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The &lt;strong&gt;source code&lt;/strong&gt; is available for free and can be found on &lt;a href=&quot;https://github.com/orjpap/podfast&quot;&gt;Github&lt;/a&gt;, I’m open to discussions about the implementation/architecture of the app and points that can and should be improved.&lt;/p&gt;

&lt;p&gt;To sum up, I will just quote Vasia’s carefully crafted words:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Podfast is, after all, not a digital radio simulation that aspires to send you on a nostalgia trip. It is a tool that re-establishes the user trust in a carefully selected bunch of cultural products picked by the users themselves without strain.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Orestis Papadopoulos</name></author><summary type="html">I can clearly recall my mother’s disappointment once she realised she couldn’t listen to the radio through her new iPhone. Which made total sense to me.</summary></entry></feed>